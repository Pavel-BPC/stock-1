<div class="container">
    <h1 class="text-center"></h1>
    <table class="table table-hover">
        <thead class="thead-light">
            <tr>
                <th class="text-center">№</th>
                <th class="text-center">Товар</th>
                <th class="text-center">Сотрудник</th>
                <th class="text-center">Склад</th>
                <th class="text-center">Количество</th>
                <th class="text-center">Дата</th>
                <th class="text-center">Изменить</th>
                <th class="text-center">Удалить</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let supply of supplies; let i=index">
                <td class="text-center">{{i+1}}</td>
                <td class="text-center">{{ supply.product_id}}</td>
                <td class="text-center">{{ supply.worker_id}}</td>
                <td class="text-center">{{ supply.stock_id}}</td>
                <td class="text-center">{{ supply.quantity}}</td>
                <td class="text-center">{{ supply.date}}</td>
                <td class="text-center"><a (click)="open_modal(template, supply.id)" class="btn"><span
                            class="fa fa-edit fa-2x"></span></a>
                </td>
                <td class="text-center"><a (click)="delete_supply(supply.id)" class="btn"><img
                            src="https://image.flaticon.com/icons/svg/282/282080.svg" alt="delete"></a>
                </td>
            </tr>
        </tbody>
    </table>

    <ng-template #template>
        <div class="modal-header">
            <h5>Редактирование</h5>
            <button type="button" class="close" (click)="modalRef.hide()" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>

        <div class="modal-body">

            <form [formGroup]="SupplyForm" role="form" class="form-group" novalidate>

                <div class="col">
                    <div class="form-group">
                        <label class="control-label" for="product_id">Продукт</label>
                        <select class="form-control" name="product_id" id="product_id" [(ngModel)]="product_id"
                            [ngModelOptions]="{standalone: true}">
                            <option *ngFor="let product of products" [value]="product.id">
                                {{product.name}}
                            </option>
                        </select>
                    </div>
                    <div *ngIf="SupplyForm.controls['product_id'].invalid && (SupplyForm.controls['product_id'].dirty || SupplyForm.controls['product_id'].touched)"
                        class="alert alert-danger">
                        <div *ngIf="SupplyForm.controls['product_id'].errors.required">
                            Заполните данное поле!
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="form-group">
                        <label class="control-label" for="worker_id">Ответственный</label>
                        <select class="form-control" name="worker_id" id="worker_id" [(ngModel)]="worker_id"
                            [ngModelOptions]="{standalone: true}">
                            <option *ngFor="let worker of users" [value]="worker.id">
                                {{worker.first_name}}
                            </option>
                        </select>
                    </div>
                    <div *ngIf="SupplyForm.controls['worker_id'].invalid && (SupplyForm.controls['worker_id'].dirty || SupplyForm.controls['worker_id'].touched)"
                        class="alert alert-danger">
                        <div *ngIf="SupplyForm.controls['worker_id'].errors.required">
                            Заполните данное поле!
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="form-group">
                        <label class="control-label" for="stock_id">Склад</label>
                        <select class="form-control" name="stock_id" id="stock_id" [(ngModel)]="stock_id"
                            [ngModelOptions]="{standalone: true}">
                            <option *ngFor="let stock of stocks" [value]="stock.id">
                                {{stock.name}}
                            </option>
                        </select>
                    </div>
                    <div *ngIf="SupplyForm.controls['stock_id'].invalid && (SupplyForm.controls['stock_id'].dirty || SupplyForm.controls['stock_id'].touched)"
                        class="alert alert-danger">
                        <div *ngIf="SupplyForm.controls['stock_id'].errors.required">
                            Заполните данное поле!
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="form-group">
                        <label class="control-label" for="partner_id">Поставщик</label>
                        <select class="form-control" name="partner_id" id="partner_id" [(ngModel)]="partner_id"
                            [ngModelOptions]="{standalone: true}">
                            <option *ngFor="let partner of partners" [value]="partner.id">
                                {{partner.name}}
                            </option>
                        </select>
                    </div>
                    <!-- <div *ngIf="SupplyForm.controls['partner_id'].invalid && (SupplyForm.controls['stock_id'].dirty || SupplyForm.controls['stock_id'].touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="SupplyForm.controls['stock_id'].errors.required">
                                        Заполните данное поле!
                                    </div>
                                </div> -->
                </div>

                <div class="col">
                    <div class="form-group">
                        <label class="control-label" for="quantity">Количество</label>
                        <input formControlName="quantity" class="form-control quantity" [(ngModel)]="res.quantity"
                            [value]="res.quantity" type="text" #quantity>
                    </div>
                    <div *ngFor="let validation of acquantity_validation_messages.quantity">
                        <div class="alert alert-danger" *ngIf="SupplyForm.get('quantity').hasError(validation.type) &&
                                                               (SupplyForm.get('quantity').dirty ||
                                                               SupplyForm.get('quantity').touched)">
                            {{validation.message}}
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="form-group">
                        <label class="control-label" for="date">Дата</label>
                        <input formControlName="date" class="form-control date" [(ngModel)]="res.date"
                            [value]="res.date" type="date" #date>
                    </div>
                    <!-- <div *ngFor="let validation of acquantity_validation_messages.date">
                                    <div class="alert alert-danger" *ngIf="SupplyForm.get('date').hasError(validation.type) &&
                                                                   (SupplyForm.get('date').dirty ||
                                                                   SupplyForm.get('date').touched)">
                                        {{validation.message}}
                                    </div>
                                </div> -->
                </div>

            </form>

        </div>

        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="modalRef.hide()">Отменить</button>
            <button type="button" class="btn btn-primary"
                (click)="save(product_id, worker_id, stock_id, partner_id, quantity.value, date.value)">Сохранить</button>
        </div>
    </ng-template>

</div>